import {
  select,
} from 'd3';

import {q} from './helpers';

/**
 * Setup width and height of a new svg
 * @param {string} element - string to select svg element
 * @param {object}  margin - object containing margins {top, right, bottom, left}
 * @return {object} D3 element selection
 */
const chartSetup = (element, margin) => {
  const size = q(element);
  const w = size.clientWidth - margin.left - margin.right;
  const h = size.clientHeight - margin.top - margin.bottom;

  const svg = select(element)
      .attr('width', w)
      .attr('height', h);

  svg.w = w;
  svg.h = h;

  return svg;
};

/**
 * Bind data to the hexgrid hexagons
 * @param {object} hexData - data generated by d3.hexgrid
 * @param {Array} dataset - Object array containgin data you want to add to hexagons
 */
const bindHexData = (hexData, dataset) => {
  for (const i of hexData.grid.layout) {
    if (i.datapoints > 0) {
      for (let j = 0; j < i.datapoints; j++) {
        const match = dataset.find((item) => {
          return (i[j].x == item.x && i[j].y == item.y);
        });

        if (match) {
          i[j] = {...i[j], ...match};
        }
      }
    }
  }
};

module.exports = {
  bindHexData,
  chartSetup,
};
