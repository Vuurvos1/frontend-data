import {
  max,
  select,
  scaleLinear,
  scaleBand,
} from 'd3';

import {q} from './helpers';

/**
 * Combine 2 datasets based on a certain key value
 * @param {object} svg - D3 selection you want your dots in
 * @param {object}  projection - D3 map projection
 * @param {Array} points - Array containing the points you want to draw
 */
const updateBarChart = (svg, projection, points) => {

};

/**
 * Combine 2 datasets based on a certain key value
 * @param {object} {xValue, yValue, innerWidth, innerHeight,}
 * @param {object}  data - data array
 * @return {object} xScale, yScale
 */
const setupScales = (
    xValue,
    yValue,
    innerWidth,
    innerHeight,
    data) => {
  const xScale = scaleLinear()
      .domain([0, max(data, xValue)])
      .range([0, innerWidth]);

  const yScale = scaleBand()
      .domain(data.map(yValue))
      .range([0, innerHeight])
      .padding(.1);

  return {xScale, yScale};
};

/**
 * Setup width and height of a new svg
 * @param {string} element - string to select svg element
 * @param {object}  margin - object containing margins {top, right, bottom, left}
 * @return {object} D3 element selection
 */
const chartSetup = (element, margin) => {
  const size = q(element);
  const w = size.clientWidth - margin.left - margin.right;
  const h = size.clientHeight - margin.top - margin.bottom;

  const svg = select(element)
      .attr('width', w)
      .attr('height', h);

  svg.w = w;
  svg.h = h;

  return svg;
};

/**
 * Bind data to the hexgrid hexagons
 * @param {object} hexData - data generated by d3.hexgrid
 * @param {Array} dataset - Object array containgin data you want to add to hexagons
 */
const bindHexData = (hexData, dataset) => {
  for (const i of hexData.grid.layout) {
    if (i.datapoints > 0) {
      for (let j = 0; j < i.datapoints; j++) {
        const match = dataset.find((item) => {
          return (i[j].x == item.x && i[j].y == item.y);
        });

        if (match) {
          i[j] = {...i[j], ...match};
        }
      }
    }
  }
};

module.exports = {
  updateBarChart,
  setupScales,
  bindHexData,
  chartSetup,
};
